CREATE TABLE dbo.Usuarios (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    EMAIL NVARCHAR(255) NOT NULL UNIQUE,
    CONTRASENA NVARCHAR(255) NOT NULL,
    NOMBRE NVARCHAR(100) NOT NULL,
    APELLIDO NVARCHAR(100) NOT NULL,
    ROL NVARCHAR(20) CHECK (ROL IN ('CLIENTE', 'SOPORTE')) NOT NULL,
    TELEFONO NVARCHAR(20) NULL,
    DNI NVARCHAR(20) NULL,
    ACTIVO BIT NOT NULL DEFAULT 1,
    FECHAREGISTRO DATETIME NOT NULL DEFAULT GETDATE()
);

CREATE TABLE dbo.Tickets (
    ID INT IDENTITY(1,1) PRIMARY KEY,
    TITULO NVARCHAR(200) NOT NULL,
    DESCRIPCION NVARCHAR(MAX) NOT NULL,
    ESTADO NVARCHAR(20) CHECK (ESTADO IN ('PENDIENTE', 'ASIGNADO', 'CERRADO')) NOT NULL DEFAULT 'PENDIENTE',
    CATEGORIA NVARCHAR(20) CHECK (CATEGORIA IN ('RED', 'HARDWARE', 'SOFTWARE', 'OTROS')) NOT NULL,
    FECHACREACION DATETIME NOT NULL DEFAULT GETDATE(),
    FECHAASIGNACION DATETIME NULL,
    FECHACIERRE DATETIME NULL,
    CLIENTEID INT NOT NULL,
    TECNICOID INT NULL,
    FOREIGN KEY (CLIENTEID) REFERENCES dbo.Usuarios(ID),
    FOREIGN KEY (TECNICOID) REFERENCES dbo.Usuarios(ID)
);